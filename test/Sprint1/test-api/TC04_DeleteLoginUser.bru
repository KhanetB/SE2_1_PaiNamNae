meta {
  name: TC04_DeleteLoginUser
  type: http
  seq: 4
}

delete {
  url: http://localhost:3000/api/users/me?permanent=true
  body: none
  auth: none
}

params:query {
  permanent: true
}

script:pre-request {
  const token = bru.getEnvVar("token")
  console.log(token)
  const headerVar = "Bearer "+ token
  req.setHeader("Authorization", headerVar)
}

script:post-response {
  console.log(req)
}

tests {
  test("response status should return 200",function(){
    const status = res.getStatus();
    const expected = 200;
    expect(status).to.equal(expected);
    if(status !== expected){
      bru.runner.stopExecution();
    }
  });
  
  test('response body should contain message', function(){
    const body = res.getBody();
    const message = body.message
    const expected = "User account deleted successfully."
    expect(body).to.have.property("message")
    expect(message).to.equal(expected)
    if(message !== expect){
      bru.runner.stopExecution();
    }
  })
  
  // bru.runner.setNextRequest("TC05_DeleteDeletedAccount")
}

settings {
  encodeUrl: true
  timeout: 0
}
